/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

plugins {
    id 'com.github.node-gradle.node' version '1.3.0'
}

node {
    version = '10.16.0'
    download = true
}

task copyResources(type: Copy) {
    from 'config.json', 'log4js.json', 'package.json', 'package-lock.json', '../rpm/post_install.sh'
    into 'build'
}
task copyServerConfig(type: Copy) {
    from 'app/server-config.json'
    into 'build/server/app'
}
task copyWebapp(type: Copy) {
    from '../client/dist/webapp'
    into 'build/server/app/webapp'
}

task build(type: NpmTask) {
    inputs.files(fileTree('app'))
    inputs.file('package.json')

    outputs.dir('build')

    dependsOn npm_install
    args = ['run', 'build']
}

task test(type: NpmTask) {
    args = ['run', 'test-jenkins']
}

task bundle(dependsOn: [build, copyResources, copyServerConfig, copyWebapp]) {

}

task clean {
    doLast {
        delete 'build'
    }
}

// assemble.dependsOn bundle
