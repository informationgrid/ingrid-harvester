/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

plugins {
    id 'com.github.node-gradle.node' version '1.3.0'
}

node {
    version = '10.16.0'
    download = true
}

npm_install {
    args = ['--production']
}

task copyConfigs(type: Copy) {
    from ('.') {
        include '*.json'
        exclude 'tsconfig.json'
    }
    into 'build/server'
}
task copyWebapp(type: Copy) {
    from '../client/dist/webapp'
    into 'build/server/app/webapp'
}

task copyNodeModuls(type: Copy) {
    from '/node_modules'
    into 'build/server/node_modules'
}

task build(type: NpmTask) {
    inputs.files(fileTree('app'))
    inputs.file('package.json')

    outputs.dir('build')

    dependsOn npm_install
    args = ['run', 'build']
}

task test(type: NpmTask) {
    args = ['run', 'test-jenkins']
}

task bundle(dependsOn: [build, copyConfigs, copyWebapp, copyNodeModuls]) {
}

task clean {
    doLast {
        delete 'build'
    }
}

// assemble.dependsOn bundle
