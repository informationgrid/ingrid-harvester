/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id "nebula.rpm" version "8.1.0"
    id "fr.brouillard.oss.gradle.jgitver" version "0.9.1"
    //id 'com.github.joschi.licenser' version '0.6.1'
}

//apply from: "${rootDir}/gradle/license.gradle"

repositories {
    jcenter()
}

version = 'MANAGED_BY_JGITVER'
description = 'InGrid mCLOUD Importer'

jgitver {
    nonQualifierBranches = 'master,develop'
}


task buildRpm(type: Rpm) {
    packageName 'mcloud-importer'
    release '1'
    arch 'noarch'
    os LINUX
    addParentDirs false
    obsoletes('mcloud-ingrid')
    vendor 'wemove digital solutions GmbH'
    packager 'wemove digital solutions GmbH'
    url 'https://www.wemove.com'
    changeLogFile project.file("${project.projectDir}/changelog")

    postInstall file('rpm/post_install.sh')
    preUninstall file('rpm/pre_uninstall.sh')

    from('server/build/server') {
        user='ingrid'
        permissionGroup='ingrid'
        createDirectoryEntry true
        exclude 'test'
        into '/opt/ingrid/mcloud-importer'
    }

    from('server') {
        include 'log4js.json', 'config.json', 'mappings.json', 'def_licenses.rdf'
        user='ingrid'
        permissionGroup='ingrid'
        fileType CONFIG | NOREPLACE
        into '/opt/ingrid/mcloud-importer'
    }

    from('server/node_modules') {
        user='ingrid'
        permissionGroup='ingrid'
        into '/opt/ingrid/mcloud-importer/node_modules'
    }

    from('rpm/mcloud-importer.service') {
        user='root'
        permissionGroup='root'
        into '/etc/systemd/system'
    }
}

